firstbranch code, modified in firstbranch only